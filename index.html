<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Enstars Story Timeline</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<h1>Enstars Stories (Release Order)</h1>

<!-- Category Tabs -->
<div class="tabs" id="category-tabs">
  <div class="tab active" data-category="All">All Stories</div>
  <div class="tab" data-category="Main">Main Story</div>
  <div class="tab" data-category="Event">Event Story</div>
  <div class="tab" data-category="Scout">Scout Story</div>
  <div class="tab" data-category="Unit">Unit Story</div>
</div>
<!-- Toggle -->
<div class="sort-container" style="text-align:center; margin-bottom:15px;">
  <label for="sort">Sort by: </label>
  <select id="sort">
    <option value="release">Release Order</option>
    <option value="chronological">Chronological</option>
  </select>
</div>

<!-- Search -->
<div class="search-container">
  <input type="text" id="search" placeholder="Search story...">
</div>

<!-- Timeline container -->
<div class="timeline" id="timeline"></div>

<script>
const sortSelect = document.getElementById('sort');

function renderTimeline(category='All', searchText='', sortBy='release'){
  timeline.innerHTML='';
  let filtered = stories.filter(s => (category==='All'||s.category===category) && s.title.toLowerCase().includes(searchText.toLowerCase()));

  // Sorting
  if(sortBy==='chronological'){
    filtered.sort((a,b)=> new Date(a.date)-new Date(b.date));
  } else {
    filtered.sort((a,b)=> a.id.localeCompare(b.id)); // Assuming id roughly follows release order
  }

  filtered.forEach((story,index)=>{
    const card=document.createElement('div');
    card.className='story-card '+(index%2===0?'story-left':'story-right');

    // Character icons
    let charIcons='';
    if(story.characters){
      charIcons=story.characters.map(c=>`<img class="character-icon" src="${characterData[c].img}" title="${characterData[c].name}">`).join('');
    }

    // Scene list
    const scenesHTML=story.events.map((ev,i)=>`
      <div class="scene-title" onclick="this.nextElementSibling.style.display=this.nextElementSibling.style.display==='block'?'none':'block'">
        ${ev.title}
      </div>
      <div class="scene-content">
        <div>${ev.text}</div>
        ${ev.img?`<img src="${ev.img}">`:''}
      </div>
    `).join('');

    card.innerHTML=`
      <div class="story-title">${story.title}</div>
      <div class="story-meta">${story.category} | ${story.date} | ${charIcons}</div>
      <div class="scene-list">${scenesHTML}</div>
    `;
    card.addEventListener('click',()=>{ 
      const list=card.querySelector('.scene-list');
      list.style.display=list.style.display==='block'?'none':'block';
    });
    timeline.appendChild(card);
  });
}

// Tab switching
tabs.forEach(tab=>{
  tab.addEventListener('click',()=>{
    tabs.forEach(t=>t.classList.remove('active'));
    tab.classList.add('active');
    renderTimeline(tab.dataset.category, searchInput.value, sortSelect.value);
  });
});

// Search filter
searchInput.addEventListener('input',()=>{
  const activeCategory=document.querySelector('.tab.active').dataset.category;
  renderTimeline(activeCategory, searchInput.value, sortSelect.value);
});

// Sort change
sortSelect.addEventListener('change',()=>{
  const activeCategory=document.querySelector('.tab.active').dataset.category;
  renderTimeline(activeCategory, searchInput.value, sortSelect.value);
});

// Initial render
renderTimeline('All', '', sortSelect.value);

</script>

</body>
</html>
